dist: buster
sudo: required
language: generic

services:
  - docker

env:
  global:
  - NJOBS="2"
  - CONTRIB="multinomials"
  - OPAMYES=yes
  matrix:
  - DOCKERIMAGE="mathcomp/mathcomp:1.8.0-coq-8.7"
  - DOCKERIMAGE="mathcomp/mathcomp:1.8.0-coq-8.8"
  - DOCKERIMAGE="mathcomp/mathcomp:1.8.0-coq-8.9"
  - DOCKERIMAGE="mathcomp/mathcomp:1.9.0-coq-8.7"
  - DOCKERIMAGE="mathcomp/mathcomp:1.9.0-coq-8.8"
  - DOCKERIMAGE="mathcomp/mathcomp:1.9.0-coq-8.9"
  - DOCKERIMAGE="mathcomp/mathcomp:1.9.0-coq-8.10"
  - DOCKERIMAGE="mathcomp/mathcomp-dev:coq-8.7"
  - DOCKERIMAGE="mathcomp/mathcomp-dev:coq-8.8"
  - DOCKERIMAGE="mathcomp/mathcomp-dev:coq-8.9"
  - DOCKERIMAGE="mathcomp/mathcomp-dev:coq-8.10"

install:
- docker pull ${DOCKERIMAGE}
- docker tag  ${DOCKERIMAGE} ci:current
- docker run  --env OPAMYES -itd --name CI -v ${PWD}:/home/ci/${CONTRIB} ci:current
- docker exec CI sh -c "opam pin add -n coq-mathcomp-${CONTRIB} ."
- docker exec CI sh -c "opam install --deps-only coq-mathcomp-${CONTRIB}"

script: |
- docker exec CI sh -c "opam install coq-mathcomp-${CONTRIB}"
